"use strict";var express=require("express");var bodyParser=require("body-parser");var request=require("request");var app=express();var Recommendations=require("./recommendations.js");var ACCESS_TOKEN=process.env.FB_PAGE_ACCESS_TOKEN;var REQUEST_URI="https://graph.facebook.com/v2.6/me/messages";app.set("port",process.env.PORT||5e3);app.use(bodyParser.urlencoded({extended:false}));app.use(bodyParser.json());app.get("/",function(req,res){res.send("Welcome to the land of sizzling sausages.")});app.post("/webhook/",function(req,res){var data=req.body;if(data.object=="page"){data.entry.forEach(function(pageEntry){var pageId=pageEntry.id;var timeOfEvent=pageEntry.time;pageEntry.messaging.forEach(function(messagingEvent){if(messagingEvent.message){receivedMessage(messagingEvent)}else if(messagingEvent.postback){receivedPostback(messagingEvent)}})})}res.sendStatus(200)});function receivedMessage(event){var senderId=event.sender.id;var recipientId=event.recipient.id;var timeOfMessage=event.timestamp;var message=event.message;console.log("Received message for user %d and page %d at %d with message:",senderId,recipientId,timeOfMessage);console.log(JSON.stringify(message));sendTextMessage(senderId)}function receivedPostback(event){console.log("postback not yet implemented")}function sendTextMessage(recipientId,messageText){var messageData={recipient:{id:recipientId},message:{text:Recommendations.randomRestaurant()}};callSendAPI(messageData)}function callSendAPI(messageData){request({uri:REQUEST_URI,qs:{access_token:ACCESS_TOKEN},method:"POST",json:messageData},function(error,response,body){if(!error&&response.statusCode==200){var recipientId=body.recipient_id;var messageId=body.message_id;if(messageId){console.log("Successfully sent message with id %s to recipient %s",messageId,recipientId)}else{console.log("Successfully called Send API for recipient %s",recipientId)}}else{console.error("Failed calling Send API",response.statusCode,response.statusMessage,body.error)}})}app.listen(app.get("port"),function(){console.log("running on port",app.get("port"))});"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Recommendations=function(){function Recommendations(){_classCallCheck(this,Recommendations)}_createClass(Recommendations,[{key:"randomRestaurant",value:function randomRestaurant(){return"In-N-Out Burger"}}]);return Recommendations}();module.exports=new Recommendations;